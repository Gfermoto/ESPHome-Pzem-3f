# –£–º–Ω—ã–π —Ç—Ä–µ—Ö—Ñ–∞–∑–Ω—ã–π —ç–Ω–µ—Ä–≥–æ–º–æ–Ω–∏—Ç–æ—Ä –Ω–∞ ESP32 –∏ PZEM-004T

–ü—Ä–æ–µ–∫—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç—Ä–µ—Ö—Ñ–∞–∑–Ω–æ–≥–æ —ç–ª–µ–∫—Ç—Ä–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤ Home Assistant —á–µ—Ä–µ–∑ ESPHome.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ –≤—Å–µ–º —Ç—Ä–µ–º —Ñ–∞–∑–∞–º:
  - –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ (V)
  - –¢–æ–∫ (A)
  - –ê–∫—Ç–∏–≤–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å (W)
  - –ß–∞—Å—Ç–æ—Ç–∞ (Hz)
  - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –º–æ—â–Ω–æ—Å—Ç–∏
  - –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è (kWh)
- üö® –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏:
  - –°—Ç–∞—Ç—É—Å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è
  - –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–≤–µ—Ä—Ü—ã —ç–ª–µ–∫—Ç—Ä–æ—â–∏—Ç–∫–∞
  - –°–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–∏–º–µ—Ç—Ä–∞
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- üåê –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–ø–æ—Ä—Ç 80)
- üì∂ OTA-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—à–∏–≤–∫–∏

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
- –ú–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä: ESP32 (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å –Ω–∞ ESP32-DevKitC)
- –î–∞—Ç—á–∏–∫–∏: 3 √ó PZEM-004T v3.0
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –ö–Ω–æ–ø–∫–∏/–≥–µ—Ä–∫–æ–Ω—ã –¥–ª—è –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞—Ç—á–∏–∫–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –≤ –ø–∞–ø–∫—É `esphome`
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Å–µ–∫—Ü–∏—è—Ö:
   - `wifi` - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∞—à–µ–π —Å–µ—Ç–∏
   - `ota` - –ø–∞—Ä–æ–ª—å –¥–ª—è OTA-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
   - `api` - –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
3. –ü—Ä–æ—à–µ–π—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —á–µ—Ä–µ–∑ USB –∏–ª–∏ OTA
4. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
–§–∞–∑–∞ A: TX=GPIO19, RX=GPIO18
–§–∞–∑–∞ B: TX=GPIO17, RX=GPIO16
–§–∞–∑–∞ C: TX=GPIO1, RX=GPIO3

–ë–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏:

Main Power: GPIO23

PowerBox Door: GPIO22

Perimeter: GPIO21

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Home Assistant
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ HA –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤—è—Ç—Å—è:
- 18 —Å–µ–Ω—Å–æ—Ä–æ–≤ —ç–Ω–µ—Ä–≥–∏–∏ (–ø–æ 6 –Ω–∞ –∫–∞–∂–¥—É—é —Ñ–∞–∑—É)
- 4 –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞—Ç—á–∏–∫–∞
- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è—Ö:
```yaml
automation:
- trigger:
   platform: state
   entity_id: binary_sensor.power_box_door
   to: "on"
 action:
   service: notify.mobile_app
   data:
     message: "–í–Ω–∏–º–∞–Ω–∏–µ! –î–≤–µ—Ä—Ü–∞ —ç–ª–µ–∫—Ç—Ä–æ—â–∏—Ç–∞ –æ—Ç–∫—Ä—ã—Ç–∞!"
```
–ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è
–ò–∑–º–µ–Ω–∏—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–ø—Ä–æ—Å–∞ –¥–∞—Ç—á–∏–∫–æ–≤ (–ø–∞—Ä–∞–º–µ—Ç—Ä update_interval)

–î–æ–±–∞–≤—å—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã/–≤–ª–∞–∂–Ω–æ—Å—Ç–∏

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞—Ç—á–∏–∫–æ–≤

–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã fallback —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞

–°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
plaintext
Copy
PZEM-004T (–§–∞–∑–∞ A)   ESP32
     TX          ‚Üí  GPIO19
     RX          ‚Üê  GPIO18

PZEM-004T (–§–∞–∑–∞ B)   ESP32
     TX          ‚Üí  GPIO17
     RX          ‚Üê  GPIO16

PZEM-004T (–§–∞–∑–∞ C)   ESP32
     TX          ‚Üí  GPIO1
     RX          ‚Üê  GPIO3

–ë–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏:
Main Power      ‚Üí GPIO23 (–ø–æ–¥—Ç—è–∂–∫–∞ –∫ +3.3V)
PowerBox Door   ‚Üí GPIO22 (–ø–æ–¥—Ç—è–∂–∫–∞ –∫ +3.3V)
Perimeter Alarm ‚Üí GPIO21 (–ø–æ–¥—Ç—è–∂–∫–∞ –∫ +3.3V)
–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
–í—Å–µ —Ä–∞–±–æ—Ç—ã —Å –≤—ã—Å–æ–∫–∏–º –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ–º –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–º –ø–∏—Ç–∞–Ω–∏–∏

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ç–æ—Ä—ã –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ

–û–±–µ—Å–ø–µ—á—å—Ç–µ –Ω–∞–¥–µ–∂–Ω—É—é –∏–∑–æ–ª—è—Ü–∏—é –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

## –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ Grafana üìä
–í –ø—Ä–æ–µ–∫—Ç–µ –¥–æ—Å—Ç—É–ø–µ–Ω –≥–æ—Ç–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥ –¥–ª—è Grafana (`Grafana.json`), –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç:
- –ü–∞–Ω–µ–ª–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –º–æ—â–Ω–æ—Å—Ç–∏ –ø–æ —Ñ–∞–∑–∞–º (Phase Power)
- –ü–∞–Ω–µ–ª–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–æ–∫–∞ –ø–æ —Ñ–∞–∑–∞–º (Phase Current)
- –ü–∞–Ω–µ–ª–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è –ø–æ —Ñ–∞–∑–∞–º (Phase Voltage)

![–°–∫—Ä–∏–Ω—à–æ—Ç –¥–∞—à–±–æ—Ä–¥–∞ Grafana](docs/Grafana.png)

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –¥–∞—à–±–æ—Ä–¥–∞:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –í—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 —á–∞—Å–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ InfluxDB –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞:
1. –í Grafana –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª Dashboards ‚Üí Import
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª `Grafana.json`
3. –£–∫–∞–∂–∏—Ç–µ UID –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö InfluxDB: "1n5SWy57k"

### –ò–º–µ–Ω–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ Home Assistant:
- –ú–æ—â–Ω–æ—Å—Ç—å: phaze_a_power, phaze_b_power, phaze_c_power
- –¢–æ–∫: phaze_a_current, phaze_b_current, phaze_c_current
- –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ: phaze_a_voltage, phaze_b_voltage, phaze_c_voltage

–õ–∏—Ü–µ–Ω–∑–∏—è
MIT License. –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Ñ–∞–π–ª–µ LICENSE.
